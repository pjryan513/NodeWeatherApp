// Pipeline lab end of chapter 3
pipeline {
    agent any
    stages {
        stage('pull-from-github-build') {
            steps {
                sh '/Users/patrickryan/.nvm/versions/node/v10.12.0/bin/npm install'
            }
			post {
				failure {
					echo "I failed to build (sob)"
				}
			}
        }
        stage('execute-unit-tests') {
            steps{
               sh '/Users/patrickryan/.nvm/versions/node/v10.12.0/bin/npm test'
            }
        }
        stage('run-program') {
            input {
                message "Enter a city"
                ok "OK"
                submitter "Lou Marco"
                parameters {
                    string(name: 'city', 
 					    defaultValue: 'Portland', 
					    description: 'Whats the weather there?')
                }
            }
            steps{
               sh '/Users/patrickryan/.nvm/versions/node/v10.12.0/bin/node index.js -c $city'
            }
        }
    }
    post { 
        always { 
           sh "/Users/patrickryan/.nvm/versions/node/v10.12.0/bin/npm run cleanup"
        }
    }
}